---
import Sidebar from '../components/Sidebar.astro';
import Footer from '../components/Footer.astro';
import TableOfContents from '../components/TableOfContents.astro';
import '../styles/global_settings.css';
import { format } from 'date-fns';

const { title, headings = [], currentPath } = Astro.props;
const isHomePage = currentPath === '/';
const currentDate = format(new Date(), 'MMMM dd, yyyy');
const currentTime = format(new Date(), 'HH:mm:ss');
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title || 'Portfolio Website'}</title>
    <link rel="stylesheet" href="/styles/global_settings.css" />
    <slot name="head" />
    
    <!-- Cat eye tracking script -->
    <script>
      document.addEventListener('mousemove', (e) => {
        const cat = document.querySelector('.cat-image');
        if (!cat) return;
        
        const rect = cat.getBoundingClientRect();
        const catX = rect.left + rect.width / 2;
        const catY = rect.top + rect.height / 2;
        
        const angle = Math.atan2(e.clientY - catY, e.clientX - catX);
        const eyeMove = 3; // pixels the eyes can move
        
        const eyes = document.querySelectorAll('.cat-eye');
        eyes.forEach(eye => {
          const x = Math.cos(angle) * eyeMove;
          const y = Math.sin(angle) * eyeMove;
          eye.style.transform = `translate(${x}px, ${y}px)`;
        });
      });
    </script>
  </head>
  <body>
    <div class="min-h-screen bg-[#f2f2f2]  md:p-8">
      <!-- Navigation Bar - Always shown -->
      <nav class="bg-white rounded-full mx-32 px-4 py-3 md:px-6 md:py-4 flex items-center justify-between mb-6 shadow-sm">
        <a href="/" class="font-medium text-sm md:text-base hover:text-[#005ac8]">Jaya Arun Kumar Tulluri</a>
        
        {isHomePage ? (
          <div class="hidden md:flex items-center space-x-8">
            <a href="/" class={`hover:text-[#005ac8] text-[0.8em] ${currentPath === '/' ? 'text-[#005ac8]' : ''}`}>
              Home
            </a>
            <a href="/skills" class={`hover:text-[#005ac8] text-[0.8em] ${currentPath === '/skills' ? 'text-[#005ac8]' : ''}`}>
              Skills
            </a>
            <a href="/experience" class={`hover:text-[#005ac8] text-[0.8em] ${currentPath === '/experience' ? 'text-[#005ac8]' : ''}`}>
              Experience
            </a>
            <a href="/projects" class={`hover:text-[#005ac8] text-[0.8em] ${currentPath === '/projects' ? 'text-[#005ac8]' : ''}`}>
              Projects
            </a>
          </div>
        ) : (
          <div class="flex items-center space-x-4">
            <div class="text-[0.8em] text-gray-600">{currentDate} | {currentTime}</div>
            <div class="cat-image relative w-10 h-10 bg-gray-100 rounded-full overflow-hidden">
              <img 
                src="https://images.pexels.com/photos/1543793/pexels-photo-1543793.jpeg?auto=compress&cs=tinysrgb&w=40" 
                alt="Persian Cat"
                class="w-full h-full object-cover"
              />
              <div class="cat-eye absolute top-[35%] left-[30%] w-2 h-2 bg-black rounded-full"></div>
              <div class="cat-eye absolute top-[35%] right-[30%] w-2 h-2 bg-black rounded-full"></div>
            </div>
          </div>
        )}
        
        <div class="flex items-center space-x-4">
          <a href="https://github.com" aria-label="GitHub" target="_blank" rel="noopener">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path>
              <path d="M9 18c-4.51 2-5-2-7-2"></path>
            </svg>
          </a>
          <a href="https://linkedin.com" aria-label="LinkedIn" target="_blank" rel="noopener">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path>
              <rect width="4" height="12" x="2" y="9"></rect>
              <circle cx="4" cy="4" r="2"></circle>
            </svg>
          </a>
        </div>
      </nav>

      <div class="flex flex-col md:flex-row gap-6">
        <!-- Sidebar -->
        <div id="sidebar-container" class="hidden md:block sidebar">
          <Sidebar currentPath={currentPath} />
        </div>
        
        <!-- Main Content -->
        <div class="flex-1 flex flex-col">
          <div class="flex flex-col md:flex-row flex-1 p-2 bg-[#FFFFFF] rounded-lg mb-4">
            <!-- Section 1: Content (Scrollable) -->
            <div class={`w-full ${isHomePage || !headings.length ? 'md:w-full' : 'md:w-1/2'} overflow-y-auto mb-4 md:mb-0 min-h-70vh`}>
              <div class="p-6 md:p-8 overflow-y-auto h-full">
                <div class="prose prose-invert max-w-none">
                  <slot />
                </div>
              </div>
            </div>
            
            <!-- Section 2: Table of Contents -->
            {!isHomePage && headings.length > 0 && (
              <div class="w-full md:w-1/2 bg-[#00d1bf] p-6 md:p-8 text-white min-h-70vh">
                <TableOfContents headings={headings} />
              </div>
            )}
          </div>
        </div>
      </div>
      
      <!-- Footer -->
      <Footer />
    </div>
    
    <script>
      // Mobile menu toggle
      const mobileMenuButton = document.getElementById('mobile-menu-button');
      const mobileMenu = document.getElementById('mobile-menu');
      
      if (mobileMenuButton && mobileMenu) {
        mobileMenuButton.addEventListener('click', () => {
          mobileMenu.classList.toggle('hidden');
        });
      }
      
      // Update time every second
      setInterval(() => {
        const timeElement = document.querySelector('.text-gray-600');
        if (timeElement) {
          const now = new Date();
          const hours = String(now.getHours()).padStart(2, '0');
          const minutes = String(now.getMinutes()).padStart(2, '0');
          const seconds = String(now.getSeconds()).padStart(2, '0');
          timeElement.textContent = `${format(now, 'MMMM dd, yyyy')} | ${hours}:${minutes}:${seconds}`;
        }
      }, 1000);
      
      // Sidebar toggle for mobile
      const toggleSidebarButton = document.getElementById('toggle-sidebar');
      const sidebarContainer = document.getElementById('sidebar-container');
      
      if (toggleSidebarButton && sidebarContainer) {
        toggleSidebarButton.addEventListener('click', () => {
          sidebarContainer.classList.toggle('hidden');
        });
      }
      
      // Submenu toggles
      document.addEventListener('DOMContentLoaded', () => {
        const toggleButtons = document.querySelectorAll('.toggle-btn');
        
        toggleButtons.forEach(button => {
          button.addEventListener('click', () => {
            const submenu = button.nextElementSibling;
            
            if (submenu && submenu.classList.contains('submenu')) {
              if (!submenu.classList.contains('hidden')) {
                submenu.classList.add('hidden');
                const icon = button.querySelector('.toggle-icon');
                if (icon) {
                  icon.classList.remove('rotate-180');
                }
                return;
              }
              
              document.querySelectorAll('.submenu').forEach(menu => {
                if (menu !== submenu) {
                  menu.classList.add('hidden');
                  const parentButton = menu.previousElementSibling;
                  if (parentButton) {
                    const parentIcon = parentButton.querySelector('.toggle-icon');
                    if (parentIcon) {
                      parentIcon.classList.remove('rotate-180');
                    }
                  }
                }
              });
              
              submenu.classList.remove('hidden');
              const icon = button.querySelector('.toggle-icon');
              if (icon) {
                icon.classList.add('rotate-180');
              }
            }
          });
        });
      });
    </script>
  </body>
</html>