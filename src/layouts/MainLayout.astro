---
import Sidebar from '../components/Sidebar.astro';
import Footer from '../components/Footer.astro';
import TableOfContents from '../components/TableOfContents.astro';
import '../styles/global_settings.css';
import { format } from 'date-fns';

const { title, headings = [], currentPath } = Astro.props;
const isHomePage = currentPath === '/';
const currentDate = format(new Date(), 'MMMM dd, yyyy');
const currentTime = format(new Date(), 'HH:mm:ss');
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title || 'Portfolio Website'}</title>
    <link rel="stylesheet" href="/styles/global_settings.css" />
    <slot name="head" />
  </head>
  <body>
    <div class="min-h-screen bg-[#f0f0f0] dark:bg-gray-900 flex flex-col">
      <!-- Top Navigation Bar - Always visible -->
      <nav class="sticky top-0 z-50 bg-white dark:bg-gray-800 shadow-lg">
        <!-- Primary Navbar -->
        <div class="px-4 h-14 flex items-center justify-between border-b border-gray-200 dark:border-gray-700">
          <!-- Left side - Empty for desktop, Menu button for mobile -->
          <button id="mobile-menu-button" class="md:hidden p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
            <span class="sr-only">Open menu</span>
            <svg width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
          </button>

          <!-- Right side - Icons -->
          <div class="flex items-center space-x-4">
            <button id="theme-toggle" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
              <span class="sr-only">Toggle theme</span>
              <svg class="sun-icon hidden dark:block" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="5"></circle>
                <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path>
              </svg>
              <svg class="moon-icon block dark:hidden" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
              </svg>
            </button>
            <a href="https://github.com" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700" target="_blank" rel="noopener">
              <span class="sr-only">GitHub</span>
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
              </svg>
            </a>
            <a href="https://linkedin.com" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700" target="_blank" rel="noopener">
              <span class="sr-only">LinkedIn</span>
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path>
                <rect x="2" y="9" width="4" height="12"></rect>
                <circle cx="4" cy="4" r="2"></circle>
              </svg>
            </a>
          </div>
        </div>

        <!-- Secondary Navbar - Mobile Menu Button -->
        <div class="md:hidden px-4 h-12 flex items-center border-b border-gray-200 dark:border-gray-700">
          <button id="mobile-nav-button" class="flex items-center space-x-2 text-gray-600 dark:text-gray-300">
            <span>Menu</span>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 9l-7 7-7-7"></path>
            </svg>
          </button>
        </div>
      </nav>

      <!-- Mobile Navigation Menu -->
      <div id="mobile-menu" class="fixed inset-0 z-40 hidden">
        <div class="fixed inset-0 bg-black bg-opacity-50" id="mobile-menu-overlay"></div>
        <div class="fixed inset-y-0 left-0 w-[80%] max-w-sm bg-white dark:bg-gray-800 shadow-xl transform transition-transform duration-300 translate-x-[-100%]" id="mobile-menu-content">
          <div class="h-full overflow-y-auto">
            <Sidebar currentPath={currentPath} />
          </div>
        </div>
      </div>

      <!-- Main content area -->
      <div class="flex-1 flex flex-col md:flex-row gap-6 p-4 md:p-8">
        <!-- Sidebar - Hidden on mobile, shown on desktop -->
        <div class="hidden md:block md:w-72 flex-shrink-0">
          <Sidebar currentPath={currentPath} />
        </div>
        
        <!-- Main Content -->
        <div class="flex-1 flex flex-col">
          <div class="flex flex-col md:flex-row flex-1 bg-white dark:bg-gray-800 rounded-lg shadow-lg">
            <!-- Content Section -->
            <div class={`w-full ${!isHomePage && headings.length > 0 ? 'md:w-3/4' : ''} overflow-y-auto`}>
              <div class="p-6 md:p-8">
                <div class="prose prose-invert dark:prose-dark max-w-none">
                  <slot />
                </div>
              </div>
            </div>
            
            <!-- Table of Contents - Hidden on mobile -->
            {!isHomePage && headings.length > 0 && (
              <div class="hidden md:block w-1/4 p-6 md:p-8 border-l border-gray-200 dark:border-gray-700">
                <TableOfContents headings={headings} />
              </div>
            )}
          </div>
        </div>
      </div>
      
      <Footer />
    </div>

    <script>
      // Mobile menu functionality
      const mobileMenuButton = document.getElementById('mobile-menu-button');
      const mobileNavButton = document.getElementById('mobile-nav-button');
      const mobileMenu = document.getElementById('mobile-menu');
      const mobileMenuContent = document.getElementById('mobile-menu-content');
      const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');

      function toggleMobileMenu() {
        const isOpen = !mobileMenu.classList.contains('hidden');
        
        if (isOpen) {
          // Close menu
          mobileMenuContent.style.transform = 'translateX(-100%)';
          setTimeout(() => {
            mobileMenu.classList.add('hidden');
          }, 300);
        } else {
          // Open menu
          mobileMenu.classList.remove('hidden');
          setTimeout(() => {
            mobileMenuContent.style.transform = 'translateX(0)';
          }, 10);
        }
      }

      [mobileMenuButton, mobileNavButton].forEach(button => {
        if (button) {
          button.addEventListener('click', toggleMobileMenu);
        }
      });

      if (mobileMenuOverlay) {
        mobileMenuOverlay.addEventListener('click', toggleMobileMenu);
      }

      // Theme toggle functionality
      const themeToggle = document.getElementById('theme-toggle');
      
      if (themeToggle) {
        // Check for saved theme preference or use system preference
        const savedTheme = localStorage.getItem('theme');
        const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        
        if (savedTheme === 'dark' || (!savedTheme && systemPrefersDark)) {
          document.documentElement.classList.add('dark');
        }
        
        themeToggle.addEventListener('click', () => {
          document.documentElement.classList.toggle('dark');
          
          // Save preference
          if (document.documentElement.classList.contains('dark')) {
            localStorage.setItem('theme', 'dark');
          } else {
            localStorage.setItem('theme', 'light');
          }
        });
      }
    </script>
  </body>
</html>